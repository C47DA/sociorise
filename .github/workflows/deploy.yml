name: Deploy to cPanel

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Install lftp
        run: sudo apt-get install lftp
        
      - name: Install Composer
        run: |
          php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
          php composer-setup.php --install-dir=/usr/local/bin --filename=composer
          php -r "unlink('composer-setup.php');"
          
      - name: Install Dependencies
        run: composer install --no-dev --optimize-autoloader
        
      - name: ðŸ“‚ Deploy to cPanel
        run: |
          lftp -e "
          set ssl:verify-certificate no;
          open ftp://${{ secrets.CPANEL_USERNAME }}:${{ secrets.CPANEL_PASSWORD }}@216.158.67.172;
          mirror -R -e -v --ignore-time --parallel=10 --exclude-glob .git/ --exclude-glob .github/ --exclude-glob node_modules/ --exclude-glob .env --exclude-glob .DS_Store --exclude-glob README.md --exclude-glob composer.lock --exclude-glob package-lock.json ./ /public_html/;
          quit" 